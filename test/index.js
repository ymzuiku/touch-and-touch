!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("mico-db")):"function"==typeof define&&define.amd?define(["mico-db"],t):(e=e||self).touchAndTouch=t(e.micoDb)}(this,function(f){"use strict";function i(i,a,s,c){return new(s=s||Promise)(function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,o)}r((c=c.apply(i,a||[])).next())})}function v(n,o){var r,i,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=o.call(n,s)}catch(e){t=[6,e],i=0}finally{r=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function l(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,r++)o[r]=i[a];return o}f=f&&f.hasOwnProperty("default")?f.default:f;var d=["submit","onchange"],p=["mousedown","touchend"],h=l(["input","submit"],p,d),a=["input","a","button","textarea","command","option","form","video"],m={speed:1,events:[],lastFocus:null,onUpdate:function(){}};var b={};var g=function(e){if(!e||!e.getAttribute)return"";var t=e.getAttribute("tat-id"),n=e.nodeName?e.nodeName.toLocaleLowerCase():"",o='[tat-auto="'+e.getAttribute("tat-auto")+'"]';return t&&"[tat-id="+t+"]"||e.id&&"#"+e.id||e.name&&n+'[name="'+e.name+'"]'||o};function w(e,t){var n=e.getAttribute(t);if(!n){var o=e.closest("["+t+"]");o&&(n=o.getAttribute(t))}return n||""}var y=function(){return window.location.pathname+window.location.hash.split("?")[0]};function n(o,r){if(!o.closest("[tat-ignore]")){if(!o.getAttribute("tat-auto")){var e=w(o,"id"),t=w(o,"key"),n=w(o,"tat-id"),i=o.getAttribute("placeholder"),a=o.getAttribute("name"),s=o.getAttribute("type"),c=y();o.setAttribute("tat-auto",function(e,t){void 0===t&&(t="c");var n=b[e];if(n)return t+n;for(var o="",r=0;r<e.length;r++)""===o?o=e.charCodeAt(r).toString(36):o+=e.charCodeAt(r).toString(36);return t+(b[e]=o)}([c,o.nodeName,i,a,s,e,t,n].filter(Boolean).join("0")))}if(!o.getAttribute("tat-seted")){o.setAttribute("tat-seted","1");var u=h;"FORM"===o.nodeName&&(u=l(d)),u.forEach(function(n){o["tat-"+n]||(o["tat-"+n]=!0,"input"===n&&"checkbox"===o.type||o.addEventListener(n,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r({key:g(o),event:n,value:function(e){if("object"==typeof e&&e.target){var t=e.target,n=t.getAttribute("type");return"checkbox"===n||"radio"===n?t.checked:e.target.value}return e||""}(e[0])})}))})}}}function s(e,t){t&&e.querySelectorAll(a.join(",")).forEach(function(e){n(e,t)})}function e(t,n){Object.keys(n).forEach(function(e){t.style[e]=n[e]})}var x="tat-replaying",c="tat-startRecord",S="tat-replayingData",u="tat-cache",E="tat-nowData",k="tat-id",A={FORM:1,HTML:1,div:1},t="translate(-10px, -28px) ",C=document.createElement("div");e(C,{transition:"all "+.3*m.speed+"s cubic-bezier(0.23, 1, 0.32, 1)",position:"fixed",pointerEvents:"none",left:"-50px",top:"-50px",zIndex:9900});var o=document.createElement("div");e(o,{transform:"translate(-3px, -3px)",filter:"drop-shadow(0px 6px 3px rgba(0,0,0,0.25))"}),o.innerHTML='\n<svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3740"><path d="M796.377747 658.252171H584.209846l111.661948 271.985873c7.777996 18.855991-1.109999 39.997981-18.887991 47.997977l-98.329954 42.85398c-18.329991 7.999996-38.885982-1.141999-46.663978-19.427991l-106.105951-258.271878-173.327918 178.275916C229.458012 945.420037 192.00003 927.108045 192.00003 895.95406V36.598463C192.00003 3.798478 231.842011-12.191514 252.554002 10.886475l568.823733 585.083726c22.943989 22.35799 6.013997 62.281971-24.999988 62.28197z" fill="" p-id="3741"></path></svg>\n';var r=document.createElement("div");function F(e){m.lastFocus&&document.contains(m.lastFocus)&&m.lastFocus.focus&&(m.lastFocus.blur(),m.lastFocus=void 0),C.style.top=e.clientY+"px",C.style.left=e.clientX+"px",setTimeout(function(){r.style.transform=t+"scale(0.5, 0.5)",setTimeout(function(){r.style.transform=t+"scale(1, 1)"},150*m.speed)},150*m.speed)}e(r,{display:"block",transition:"all 0.2s cubic-bezier(0.23, 1, 0.32, 1)",transform:t,width:"20px",height:"20px",borderRadius:"10px",background:"rgba(0,100,255,0.35)"}),C.append(o,r),document.body.append(C);function L(e,t){var n=e.getBoundingClientRect();t.clientX=n.left+n.width/2,t.clientY=n.top+n.height/2}function R(t){return new Promise(function(e){setTimeout(e,t)})}function T(){return i(void 0,void 0,void 0,function(){var t,n,o,r,i,a,s,c,u,l,d;return v(this,function(e){switch(e.label){case 0:if(!(t=f.getSessionStorage(S)))return[2];f.setSessionStorage(x,1),n=t.speed,(o=t.events).forEach(function(e,t){e.index=t}),m.speed=n,r=0,i=o,e.label=1;case 1:return r<i.length?(a=i[r],f.getSessionStorage(x)?"mclick"!==a.event?[3,3]:[4,new Promise(function(e){setTimeout(e,300*m.speed)})]:[3,12]):[3,12];case 2:return e.sent(),F(a),[3,10];case 3:return a.key?[4,R(50*m.speed)]:[3,10];case 4:return e.sent(),[4,function(o){return new Promise(function(t){var n=function(){var e=document.querySelector(o);e?t(e):setTimeout(function(){n()},50)};n()})}(a.key)];case 5:return s=e.sent(),-1<p.indexOf(a.event)?(L(s,a),F(a),[4,R(300*m.speed)]):[3,7];case 6:return e.sent(),function(e){if(!e.closest("[tat-ignore]")){var t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.scrollIntoView(!0),e.dispatchEvent(t)}}(s),[3,10];case 7:return m.lastFocus===s?[3,9]:(L(s,a),function(e){C.style.left=e.clientX+"px",C.style.top=e.clientY+"px"}(a),[4,R(200*m.speed)]);case 8:e.sent(),e.label=9;case 9:!function(e,t,n){if(!e.closest("[tat-ignore]")){var o=(m.lastFocus=e).nodeName.toLocaleLowerCase();"input"!==o&&"textarea"!==o||e.focus();var r=new InputEvent(n,{data:t.value,view:window,bubbles:!0,cancelable:!0});e.scrollIntoView(!0),e.value=t&&t.value||"",e.dispatchEvent(r)}}(s,a,a.event),e.label=10;case 10:if(a.index===o.length-1)for(c=o.length,u=0;u<c;u++)m.events[u]=o[u];for(l=[],d=a.index||0;d<o.length;d++)l.push(o[d]);f.setSessionStorage(S,{speed:n,events:l}),e.label=11;case 11:return r++,[3,1];case 12:return f.removeSessionStorage(x),f.removeSessionStorage(S),[2]}})})}return function(e){void 0===e&&(e={}),e.events&&f.set(E,{speed:e.speed||1,events:e.events});var t=f.getSessionStorage(u);t&&t.events&&(m.events=t.events),function(e){var r=e.recordOnce,t=e.tags;null==t||t.forEach(function(e){return a.push(e)}),document.body.setAttribute(k,"body");var n=r;r=function(e){"href"===e.event&&m.events[0]&&"href"===m.events[0].event||"href"!==e.event&&f.getSessionStorage(x)||(m.events.push(e),m.onUpdate(),f.setSessionStorage(u,m),n&&n(e))},s(document.body,r);new MutationObserver(function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];"childList"===o.type&&s(o.target,r)}}).observe(document.body,{attributes:!1,childList:!0,subtree:!0}),r({event:"href",href:window.location.href}),window.addEventListener("mousedown",function(e){A[e.target.nodeName]&&r({event:"mclick",clientX:e.clientX,clientY:e.clientY})}),window.addEventListener("touchend",function(e){A[e.target.nodeName]&&r({event:"mclick",clientX:e.clientX,clientY:e.clientY})})}(e);var n={save:function(){f.set(E,m.events)},replay:function(){return i(void 0,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,f.get(E)];case 1:return function(e){if(e&&e.events){var t=e.events[0];f.setSessionStorage(S,e),t&&t.href&&(window.location.href===t.href?window.location.reload():window.location.href=t.href)}}({speed:1,events:e.sent()}),[2]}})})},stopReplay:function(){m.events[0]&&(m.events[0].href=window.location.href),m.events=[m.events[0]],f.remove(E),f.removeSessionStorage(u),f.removeSessionStorage(c),f.removeSessionStorage(x),f.removeSessionStorage(S),m.onUpdate()}};if(!e.hiddenButtons){var o=document.getElementById("tat-buttons");o&&o.remove();var r=function(e){var t=e.save,n=e.replay,o=e.stopReplay,r=document.createElement("div");r.setAttribute("tat-ignore","1"),r.style.zIndex="9901",r.style.position="fixed",r.style.right="0px",r.style.bottom="0px",r.style.color="#fff";var i=document.createElement("button");i.textContent="0",m.onUpdate=function(){i.textContent=m.events.length.toString()};var a=function(){m.events&&m.events.length?m.onUpdate():requestAnimationFrame(a)};a();var s=document.createElement("button");s.textContent="Save",s.onclick=t;var c=document.createElement("button");c.textContent="Replay",c.onclick=n;var u=document.createElement("button");return u.textContent="Stop Replay",u.onclick=o,r.append(i,s,c,u),r}(n);r.id="tat-buttons",document.body.append(r)}return T(),n}});
//# sourceMappingURL=index.js.map
